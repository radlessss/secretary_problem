# secretary_problem

## 1. Класична задача секретаря

### 1.1 Постановка

Є одна вакансія та **n** кандидатів.

**Умови:**

- Усі кандидати можуть бути однозначно впорядковані від найкращого до найгіршого.
- Кандидати проходять співбесіду послідовно у випадковому порядку.
- Після кожної співбесіди потрібно негайно прийняти рішення:
  - прийняти кандидата, або
  - відхилити його назавжди.
- Повернутися до відхиленого кандидата неможливо.
- Під час співбесіди відома лише відносна якість кандидата порівняно з уже переглянутими
  (а не абсолютна).

**Мета:**  
максимізувати ймовірність вибору найкращого кандидата з усіх **n**.



### 1.2 Оптимальний алгоритм  
*(правило 37% або правило 1/e)*

Алгоритм складається з двох фаз.

#### 1. Фаза спостереження

- Відхилити перші приблизно **n/e ≈ 0.37n** кандидатів без винятку.
- Запам’ятати найкращого серед них (але не наймати).

#### 2. Фаза вибору

- Починаючи з кандидата номер **⌊n/e⌋ + 1**, найняти першого кандидата, який:
  - кращий за всіх кандидатів, побачених раніше;
- якщо такого кандидата не з’явилося — взяти останнього.



### 1.3 Результат

Якщо найкращий кандидат з усіх з’явиться після фази спостереження, існує висока ймовірність,
що він перевершить усіх попередніх — і буде обраний.

Ця стратегія гарантує максимальну можливу ймовірність успіху: 1/e≈0.37


## 2. Кооперативна двостороння задача секретаря з threshold

### 2.1 Постановка

Розглядається двостороння версія класичної задачі секретаря, у якій рішення про зупинку
приймається кооперативно з урахуванням інформації з обох сторін пари.

Існує велика популяція агентів двох типів (умовно A та B), де кожен агент має власний,
невідомий наперед порядок переваг щодо агентів протилежного типу.
Через те, що загальний розмір популяції значно перевищує кількість раундів взаємодії,
кожна пара, що формується на кроці, є новою і унікальною.

Процес відбувається протягом обмеженої кількості раундів, нормалізованих до інтервалу (0, 1).
На кожному раунді агент з боку A зустрічається з агентом з боку B і обидві сторони
отримують оцінку поточної взаємодії.

### 2.2 Логіка алгоритму

У два етапи:

#### 1. Фаза спостереження

- Триває до нормалізованого порогу threshold ∈ (0, 1).
- На кожному кроці:
  - отримуються оцінки з обох сторін;
  - за допомогою функції агрегації (наприклад, сума або добуток)
    обчислюється спільна якість пари;
  - агент оновлює максимальну спільну якість, але не приймає рішення про шлюб.


#### 2. Фаза вибору

- Після досягнення порогу:
  - агент погоджується на шлюб із першою парою,
    чия спільна якість не гірша за максимальну,
    зафіксовану під час фази спостереження.
- Якщо такої пари не знайдено — рішення приймається в останньому раунді.

**Результат:**

На кожному кроці кожна сторона пари спостерігає лише:

- власну відносну оцінку поточного партнера;
- порівняння цієї оцінки з партнерами, яких вона бачила раніше.

Абсолютна якість партнера та інформація про майбутні пари є недоступними.
Таким чином, оцінки мають порядковий або нормалізований характер і узгоджуються
з класичними припущеннями задачі секретаря.

Кооперативний агент отримує дві незалежні оцінки:
- оцінку з боку першого агента;
- оцінку з боку другого агента.

Ці оцінки об’єднуються в одну спільну метрику якості пари.

## 2.3 Результат

Кооперативний агент реалізує двосторонню оптимальну зупинку, де:

- рішення базується на об’єднаній інформації з двох сторін;
- працює лише з локальними відносними оцінками;
- є масштабованою для великих популяцій агентів;
- поріг threshold ≈ 1/e є природним узагальненням класичного правила 37%.

## 3. Метрики

### 3.1 Для класичної задачі секретаря

**1. Ймовірність вибору найкращого кандидата**
   - `n_success` - кількість симуляцій, де вибрали найкращого кандидата
   - `n_total` - загальна кількість симуляцій

$$
\text{success rate} = \frac{n_{\text{success}}}{n_{\text{total}}}
$$

**2. Очікувана позиція обраного кандидата (середній ранг кандидата)**

  - `r_i` - ранг кандидата, якого обрав алгоритм у i-й симуляції  
  - `n_total` - загальна кількість симуляцій 

$$
\text{expected rank} = \frac{1}{n_{\text{total}}} \sum_{i=1}^{n_{\text{total}}} r_i 
$$

   Наприклад, якщо обрані кандидати мали ранги `r = [2, 5, 1, 3, 4]` у 5 симуляціях:

$$ 
\text{expected rank} = \frac{2 + 5 + 1 + 3 + 4}{5} = 3
$$

Це означає, що алгоритм у середньому обирає кандидата з третім найкращим рангом.  
Чим менше expected rank, тим ефективніше алгоритм наближається до найкращого кандидата.

**3. Розподіл обраних кандидатів за раундами**

- `s_i` - номер раунду, у якому був обраний кандидат у i-й симуляції  
- `n_total` — загальна кількість симуляцій

Середній раунд вибору обчислюється як:

$$
\text{average selection round} = \frac{1}{n_{\text{total}}} \sum_{i=1}^{n_{\text{total}}} s_i
$$

Наприклад, ми зробили 5 симуляцій, і кандидати були обрані у наступних раундах:

`s = [4, 3, 5, 4, 6]`


Тоді середній раунд вибору:

$$
\text{average selection round} = \frac{4 + 3 + 5 + 4 + 6}{5} = \frac{22}{5} = 4.4
$$

Це означає, що в середньому алгоритм обирає кандидата після 4–5 співбесід.

Ця метрика показує, на якому кроці (після скількох співбесід) зазвичай алгоритм обирає кандидата.  

- Менше значення означає, що кандидата обирають раніше.  
- Більше значення - алгоритм зазвичай довше спостерігає перед вибором.  




